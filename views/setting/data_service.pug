extends ../components/base
block title
    title 应用管理
block aside_content
    include ../components/mixin
    -var routerObj = [{link:'/',text:'应用',icon:'icon-app'},{link:'/message',text:'消息',icon:'icon-message2'},{link:'/setting/user_manage',text:'平台管理',icon:'icon-setting'}]
    +asideNav(routerObj,2)
block common_header
    include ../components/header
    +commonheader(0)
block style
    link(rel='stylesheet', href=__CSS_PATH__ + '/news.css')
    style.
        #main-wrapper {
            margin-top: 10px;
        }
block main_content
    include ../components/mixin
    -var menuObj = [{link:'/setting/organization_manage',text:'平台自身管理'},{link:'/setting/contact_manage',text:'对接系统管理'},{link:'/setting/app_manage',text:'第三方应用系统管理'},{link:'/setting/data_service',text:'数据服务管理'}]
    +menuLink(menuObj,3)
    -var navObj = [{link:'/setting/data_service',text:'数据服务'},{link:'/setting/data_service_config',text:'接口权限配置'}]
    +menuNav(navObj,0)
    +RouteNav('数据服务')
    #inner-wrapper
        header.head-block
            .inline-group
                label(for='name') 应用名称:
                input#name(type='text')
            .inline-group
                button.btn.btn-sm.btn-default(type='button' style='margin-left:20px' onclick="searchSomething();") 查询
        .content-list.section-block
            table.table.table-bordered
                thead
                    tr
                        td  中文名称
                        td  排序号
                        td  URL
                        td  应用描述
                        td  操作
                tbody
                    if(apis.length)
                        each api in apis
                            tr
                                td  #{api.name}
                                td  #{api.sortNum}
                                td  #{api.indexUrl}
                                td  #{api.descText}
                                td
                                    a.link(href='/setting/data_service_config?edit=true&id=' + api.id) 接口权限配置
                                    a.link.deleteAPI(href='javascript:void(0);' data-id=api.id style='margin-left:20px;') 删除
        if(rowsCount > 10)
            #pageInfo.pager(style="text-align:center" data-count=rowsCount)
block script
    script(type='text/javascript').
        initSearchInfo();
        function deleteAPI(id) {
            $.post("/setting/data_service_delete",{id:id},function (data) {
                if(data.code === 1){
                    layerAlert("删除成功", "ok");
                    setTimeout(function () {
                        window.location.reload();
                    },1000);
                }else{
                    layerAlert("删除失败","error");
                }
            },'json')
        }
        $('.deleteAPI').on('click',function (e) {
            var id = $(this).attr("data-id");
            if(id){
                layerAlert("确认删除吗?","confirm",deleteAPI,id);
            }
        });
